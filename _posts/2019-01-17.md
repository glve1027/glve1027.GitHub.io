---
layout:       post
title:        "关于R.Obj工具"
author:       "GH"
header-style: text
catalog:      true
tags:
    - Object-C
---

### Kiwi 测试框架
#### 安装: 通过`Cocoapods`安装`Kiwi`，命令如下：
```shell
target 'xxxTests' do
  inherit! :search_paths
  # Pods for testing
  pod 'Kiwi'
end
```
<!-- more -->

#### 安装`Kiwi`的`Xcode Template`
1. 下载 [Kiwi Template](https://github.com/kiwi-bdd/Kiwi/tree/master/Xcode%20Templates)
2. 执行安装脚本 `sh ./install-templates.sh`

#### 创建
1. 通过`Xcode`-> `File` -> `New` -> `File...`
2. 输入`Kiwi`过滤出`Kiwi Spec` -> `Next` 创建完成 [ 这里输入的文件名就是你要测试的类名 ]

#### 使用
1. Kiwi测试中的行为描述：`Given`、`When`、`Then`
2. 一个测试类中，一个测试类只会存在一个`describe` (一个测试文件应该专注于一个测试类)
3. 一个`describe`可以存在多个`context`
4. 一个`context`可以存在多个`it`

#### 这里写了一个例子，一个简单的User对象, [基本断言测试文档](https://github.com/kiwi-bdd/Kiwi/wiki/Expectations)

```java
#import <Foundation/Foundation.h>

@class DataBaseManager;

NS_ASSUME_NONNULL_BEGIN

@interface GCTUser : NSObject

@property (nonatomic, copy, readonly) NSString *userName;
@property (nonatomic, assign, readonly) NSInteger password;
@property (nonatomic, strong, readonly) NSArray *addressDatas;

- (instancetype)initWithUserName:(NSString *)userName password:(NSInteger)password;

- (void)registerAddressWith:(NSString *)addressName;
- (void)unregisterAddress;
// 测试Exception断言
- (void)forceUnregisterAddress;

// 获取用户信息数据
// 1. 
- (NSDictionary *)userInfos;
// 2. 外部传入
- (NSDictionary *)getUserInfosFrom:(DataBaseManager *)dataBaseManager;
@end

NS_ASSUME_NONNULL_END
```

```java
describe(@"Given a GCTUser", ^{ // <--Given
    /* -- 1 -- */
    context(@"when user userName is 'Hello world' and password is '123456'", ^{// <-- When
        
        GCTUser *user = [[GCTUser alloc] initWithUserName:@"Hello world" password:123456];
        
        it(@"user is exists", ^{
            [[user shouldNot] beNil];
        });
        
        it(@"userName is 'Hello world'", ^{ // <-- Then (with description)
            [[user.userName should] equal:@"Hello world"];
        });
        
        specify(^{
            [[theValue(123456) should] equal:theValue(user.password)];  // <-- Then (without description)
        });
    });
    
    /* -- 2 -- */
    context(@"when user created", ^{// <-- When
       
        __block GCTUser *user = nil;
        beforeAll(^{
            user = [GCTUser new];
        });
        
        afterAll(^{
            user = nil;
        });
        
        it(@"when user is created, address data should be empty", ^{ // <-- Then (with description)
            [[user.addressDatas should] beEmpty];
        });
    });
    
    /* -- 3 -- */
    context(@"when register address name", ^{// <-- When
        GCTUser *user = [GCTUser new];
        beforeEach(^{
            [user registerAddressWith:@"hangzhou"];
        });
        
        afterEach(^{
            [user unregisterAddress];
        });
        
        it(@"after user register, then", ^{ // <-- Then (with description)
            [[user.addressDatas.firstObject should] equal:@"hangzhou"];
        });
    });
    
    /* -- 4 -- */
    context(@"when unregister address", ^{// <-- When
        GCTUser *user = [GCTUser new];
        beforeAll(^{
            [user registerAddressWith:@"beijing"];
        });
        
        beforeEach(^{
            [user unregisterAddress];
        });
        
        it(@"after user unregister", ^{// <-- Then (with description)
            [[user.addressDatas should] beEmpty];
        });
    });
    
    /* -- 5 -- */
    context(@"when user addresses are empty", ^{
        GCTUser *user = [GCTUser new];
        
        it(@"called force ungister, will throw exception", ^{
            [[theBlock(^{
                [user forceUnregisterAddress];
            }) should] raiseWithName:@"GCTUserAddressDatasEmptyException"] ;
        });
    });
});
```
#### 第二个例子，我用MVVM模式，写了一个简单的页面，这里面用到了UITableView, 重点测试ViewModel, viewModel代码如下：
